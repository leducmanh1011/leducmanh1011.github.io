I"+9<p>Hi c√°c b·∫°n, ·ªü b√†i vi·∫øt tr∆∞·ªõc m√¨nh ƒë√£ gi·ªõi thi·ªát v·ªÅ RESTful API l√† g√¨ r·ªìi, h√¥m tr∆∞·ªõc th√¨ m√¨nh c≈©ng ƒë∆∞·ª£c tham gia m·ªôt bu·ªïi sharing ki·∫øn th·ª©c v·ªÅ c√°ch build base api cho d·ª± √°n. V·∫≠y th√¨ ƒë·ªÉ ti·∫øp n·ªëi b√†i vi·∫øt tr∆∞·ªõc h√¥m nay m√¨nh s·∫Ω th·ª≠ x√¢y d·ª±ng m·ªôt app RESTful API v·ªõi Ruby on Rails.
B√†i vi·∫øt n√†y do qu√° tr√¨nh m√¨nh l√†m vi·ªác, h·ªçc t·∫≠p c·ªông v·ªõi ki·∫øn th·ª©c tham kh·∫£o ƒë∆∞·ª£c mu·ªën chia s·∫Ω t·ªõi c√°c b·∫°n. Thanks you v√¨ ƒë√£ xem ‚ù§Ô∏è</p>

<h2 id="l·ªùi-n√≥i-ƒë·∫ßu">L·ªùi n√≥i ƒë·∫ßu</h2>

<p>·ªû phi√™n b·∫£n Rails 5, th√¨ gem rails-api ƒë√£ ƒë∆∞·ª£c t√≠ch h·ª£p v√†o ph·∫ßn core c·ªßa Rails, v√¨ v·∫≠y ch√∫ng ta c√≥ th·ªÉ kh·ªüi t·∫°o API trong Rails 1 c√°ch d·ªÖ d√†ng v√† nhanh ch√≥ng. Trong b√†i vi·∫øt n√†y m√¨nh s·∫Ω h∆∞·ªõng d·∫´n c∆° b·∫£n cho c√°c b·∫°n c√°ch ƒë·ªÉ t·∫°o m·ªôt API ƒë∆°n gi·∫£n, step by step trong Rails 5. B√†i vi·∫øt c·ªßa m√¨nh c√≥ nh·ªØng m·ª•c sau:</p>

<ul>
  <li>Chu·∫©n b·ªã m√¥i tr∆∞·ªùng</li>
  <li>T·∫°o project API trong rails 5</li>
  <li>Add Rspec v√†o project</li>
  <li>X√¢y d·ª±ng API</li>
  <li>Serializing API Output</li>
  <li>Enabling CORS</li>
  <li>Phi√™n b·∫£n API</li>
  <li>Authentication API</li>
  <li>Vi·∫øt document cho API s·ª≠ d·ª•ng Swagger UI</li>
</ul>

<h2 id="chu·∫©n-b·ªã-m√¥i-tr∆∞·ªùng">Chu·∫©n b·ªã m√¥i tr∆∞·ªùng</h2>

<p>C√°c b·∫°n h√£y setup m√¥i tr∆∞·ªùng local nh√©, c√≥ th·ªÉ tham kh·∫£o list sau c·ªßa m√¨nh. ^^</p>

<ul>
  <li>Ruby 2.6.3</li>
  <li>Rails 5.2.4.2</li>
</ul>

<h2 id="t·∫°o-project-api-trong-rails-5">T·∫°o project API trong rails 5</h2>

<p>ƒê·∫ßu ti√™n, h√£y ch·∫Øc ch·∫Øn r·∫±ng b·∫°n ƒë√£ setup xong step 1 (chu·∫©n b·ªã m√¥i tr∆∞·ªùng) c√†i phi√™n b·∫£n Ruby 2.2.2 tr·ªü l√™n v√† Rails version 5. :D</p>

<p>ƒê·ªÉ t·∫°o m·ªôt API trong rails ch·ªâ c·∫ßn th√™m mode ‚Äìapi ph√≠a sau c√¢u l·ªánh kh·ªüi t·∫°o project m·ªõi trong Rails.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rails</span> <span class="n">new</span> <span class="n">my_project</span> <span class="o">--</span><span class="n">api</span>
</code></pre></div></div>

<p>Ti·∫øp theo ch√∫ng ta ch·∫°y l·ªánh bundle ƒë·ªÉ th·ª±c hi·ªán c√†i ƒë·∫∑t c√°c gem m·∫∑c ƒë·ªãnh v√† ti·∫øn h√†nh c√†i ƒë·∫∑t database trong th∆∞ m·ª•c ch·ª©a project.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bundle</span> <span class="n">install</span>
</code></pre></div></div>

<h2 id="add-rspec-v√†o-project">Add Rspec v√†o project</h2>

<p>Sau khi c√†i ƒë·∫∑t xong project, ch√∫ng ta ti·∫øn h√†nh c√†i ƒë·∫∑t RSpec ƒë·ªÉ ti·∫øn h√†nh vi·ªác testing cho API. L√Ω do t·∫°i sao ch√∫ng ta ti·∫øn h√†nh c√†i ƒë·∫∑t RSpec ƒë·∫ßu ti√™n v√¨ n√≥ s·∫Ω gi√∫p ch√∫ng ta ti·∫øt ki·ªám th·ªùi gian b·∫±ng c√°ch s·ª≠ d·ª•ng RSpec, th√¨ n√≥ s·∫Ω ti·∫øn h√†nh t·∫°o t·ª± ƒë·ªông c√°c file test controller v√† model khi ch√∫ng ta t·∫°o c√°c model, controller</p>

<p>ƒê·ªÉ c√†i ƒë·∫∑t, trong Gemfile.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">group</span> <span class="ss">:development</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
    <span class="n">gem</span> <span class="s2">"rspec-rails"</span>
    <span class="n">gem</span> <span class="s2">"factory_girl_rails"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Sau ƒë√≥ ch·∫°y bundle install.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bundle</span> <span class="n">install</span>
</code></pre></div></div>

<h2 id="x√¢y-d·ª±ng-api">X√¢y d·ª±ng API</h2>

<p>Sau khi add Rpsec v√†o project th√¨ b∆∞·ªõc ti·∫øp theo, m√¨nh s·∫Ω x√¢y d·ª±ng API, c·ª• th·ªÉ m√¨nh s·∫Ω x√¢y d·ª±ng API CRUD my blog. S·ª≠ d·ª•ng c√¢u l·ªánh scaffold ƒë·ªÉ kh·ªüi t·∫°o nhanh model v√† controller t∆∞∆°ng ·ª©ng.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rails</span> <span class="n">g</span> <span class="n">scaffold</span> <span class="no">MyBlog</span> <span class="n">title</span> <span class="n">content</span> <span class="n">description</span>
</code></pre></div></div>
<p>N√≥ s·∫Ω sinh ra c√°c file c√≥ c·∫•u tr√∫c nh∆∞ sau:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">invoke</span>  <span class="n">active_record</span>
<span class="n">create</span>    <span class="n">db</span><span class="o">/</span><span class="n">migrate</span><span class="o">/</span><span class="mi">20200607162113</span><span class="n">_create_my_blogs</span><span class="p">.</span><span class="nf">rb</span>
<span class="n">create</span>    <span class="n">app</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">my_blog</span><span class="p">.</span><span class="nf">rb</span>
<span class="n">invoke</span>    <span class="n">test_unit</span>
<span class="n">create</span>      <span class="nb">test</span><span class="o">/</span><span class="n">models</span><span class="o">/</span><span class="n">my_blog_test</span><span class="p">.</span><span class="nf">rb</span>
<span class="n">create</span>      <span class="nb">test</span><span class="o">/</span><span class="n">fixtures</span><span class="o">/</span><span class="n">my_blogs</span><span class="p">.</span><span class="nf">yml</span>
<span class="n">invoke</span>  <span class="n">resource_route</span>
<span class="n">route</span>    <span class="n">resources</span> <span class="ss">:my_blogs</span>
<span class="n">invoke</span>  <span class="n">scaffold_controller</span>
<span class="n">create</span>    <span class="n">app</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">my_blogs_controller</span><span class="p">.</span><span class="nf">rb</span>
<span class="n">invoke</span>    <span class="n">test_unit</span>
<span class="n">create</span>      <span class="nb">test</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">my_blogs_controller_test</span><span class="p">.</span><span class="nf">rb</span>

</code></pre></div></div>
<p>V√¨ khi kh·ªüi t·∫°o project v·ªõi mode ‚Äìapi n√™n s·∫Ω kh√¥ng c√≥ th∆∞ m·ª•c view t·∫°o ra, c√°c b·∫°n ch√∫ √Ω.
Ti·∫øp theo c√°c b·∫°n ch·∫°y migrate database v√† run sever nh√©.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rails</span> <span class="n">db</span><span class="ss">:migrate</span>
<span class="n">rails</span> <span class="n">s</span>
</code></pre></div></div>

<p>API c·ªßa ch√∫ng ta b√¢y gi·ªù ƒë√£ ch·∫°y ·ªü ƒë·ªãa ch·ªâ https://localhost:3000. Tuy nhi√™n ƒë√¢y ch∆∞a ph·∫£i l√† ƒëi·ªÅu quan tr·ªçng nh·∫•t, v√¨ t·∫•t c·∫£ ch·ªâ d·ª´ng ·ªü m·ª©c c∆° b·∫£n, v√† ch√∫ng ta c√≤n nhi·ªÅu vi·ªác ph·∫£i l√†m ƒë·ªÉ t·∫°o th√†nh m·ªôt API ho√†n ch·ªânh.</p>

<h2 id="serializing-api-output-v·ªõi-fast-json-api">Serializing API Output V·ªõi Fast JSON API</h2>

<p>Trong Gemfile add line:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gem</span> <span class="s2">"fast_jsonapi"</span>
</code></pre></div></div>

<p>Ch·∫°y bundle install ƒë·ªÉ c√†i ƒë·∫∑t gem. Sau ƒë√≥ m√¨nh s·∫Ω t·∫°o class serializer t∆∞∆°ng ·ª©ng v·ªõi model, c·ª• th·ªÉ ·ªü ƒë√¢y l√† MyBlog.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">rails</span> <span class="n">g</span> <span class="n">serializer</span> <span class="no">MyBlog</span> <span class="n">title</span> <span class="n">content</span> <span class="n">description</span>
</code></pre></div></div>

<p>K·∫øt qu·∫£:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">create</span>  <span class="n">app</span><span class="o">/</span><span class="n">serializers</span><span class="o">/</span><span class="n">my_blog_serializer</span><span class="p">.</span><span class="nf">rb</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyBlogSerializer</span>
  <span class="kp">include</span> <span class="no">FastJsonapi</span><span class="o">::</span><span class="no">ObjectSerializer</span>
  <span class="n">attributes</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">:description</span>
<span class="k">end</span>
</code></pre></div></div>

<p>M·ªói class serializer s·∫Ω √°nh x·∫° v·ªõi m·ªôt model trong database, ƒë·ªÉ c√≥ th·ªÉ chuy·ªÉn d·ªØ li·ªáu t·ª´ database sang ki·ªÉu JSON ƒë·ªÉ tr·∫£ v·ªÅ cho ph√≠a front end s·ª≠ d·ª•ng</p>

<h2 id="enabling-cors">Enabling CORS</h2>

<p>CORS l√† vi·∫øt t·∫Øt c·ªßa Cross-origin resource sharing, l√† m·ªôt c∆° ch·∫ø ƒë·∫∑c bi·ªát cho ph√©p resource ƒë·∫∑t t·∫°i m·ªôt domain n√†y c√≥ th·ªÉ ƒë∆∞·ª£c request t·ª´ m·ªôt domain kh√°c v·ªõi domain ƒë√≥, nghƒ©a l√† l√†m sao ƒë·ªÉ c√≥ th·ªÉ g·ª≠i v√† nh·∫≠n d·ªØ li·ªáu gi·ªØa 2 server v·ªõi nhau. Trong tr∆∞·ªùng h·ª£p b·∫°n mu·ªën public API c·ªßa m√¨nh, th√¨ enable CORS l√† vi·ªác c·∫ßn l√†m n·∫øu nh∆∞ b·∫°n kh√¥ng mu·ªën s·ª≠ d·ª•ng JSONP, v√† h·∫ßu h·∫øt c√°c tr√¨nh duy·ªát hi·ªán nay ƒë·ªÅu ƒë√£ h·ªó tr·ª£ CORS.</p>

<p>ƒê·ªÉ l√†m ƒëi·ªÅu ƒë√≥ trong API c·ªßa ch√∫ng ta, th√¨ ch·ªâ vi·ªác c√†i ƒë·∫∑t gem rack-cors v√†o Gemfile:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gem</span> <span class="s2">"rack-cors"</span>
</code></pre></div></div>

<p>Ch·∫°y c·∫≠p nh·∫≠t bundle v√† th√™m v√†o v√†i d√≤ng code nh∆∞ ·ªü d∆∞·ªõi v√†o file config/application.rb. ·ªû v√≠ d·ª• n√†y, n√≥ s·∫Ω cho ph√©p th·ª±c hi·ªán c√°c request nh∆∞ GET, POST ho·∫∑c b·∫•t c·ª© OPTIONS request n√†o kh√°c t·ª´ b·∫•t k√¨ ƒë√¢u.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">YourApp</span>
    <span class="k">class</span> <span class="nc">Application</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Application</span>
    <span class="c1"># ...</span>
        <span class="n">config</span><span class="p">.</span><span class="nf">middleware</span><span class="p">.</span><span class="nf">insert_before</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">"Rack::Cors"</span> <span class="k">do</span>
            <span class="n">allow</span> <span class="k">do</span>
                <span class="n">origins</span> <span class="p">\</span><span class="s1">'*\'
                resource \'*\'</span><span class="p">,</span> <span class="ss">headers: :any</span><span class="p">,</span> <span class="ss">:methods</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="ss">:get</span><span class="p">,</span> <span class="ss">:post</span><span class="p">,</span> <span class="ss">:options</span><span class="p">]</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h2 id="qu·∫£n-l√≠-version-c·ªßa-api">Qu·∫£n l√≠ version c·ªßa api</h2>

<p>·ªû b√†i vi·∫øt tr∆∞·ªõc m√¨nh c≈©ng ƒë√£ n√≥i qua v·ªÅ vi·ªác qu·∫£n l√≠ version cho API r·ªìi.</p>

<p>ƒêi·ªÅu n√†y s·∫Ω gi√∫p h·ªá th·ªëng sau khi n√¢ng c·∫•p l√™n version m·ªõi v·∫´n h·ªô tr·ª£ c√°c api c·ªßa version c≈©, c≈©ng nh∆∞ gi√∫p vi·ªác b·∫£o tr√¨, s·ª≠a ch·ªØa d·ªÖ d√†ng h∆°n.</p>

<p>C√≥ nhi·ªÅu c√°ch ƒë·ªÉ chia version cho API, m√¨nh th∆∞·ªùng hay d√πng nh∆∞ th·∫ø n√†y =))</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"application#root"</span>

  <span class="n">namespace</span> <span class="ss">:api</span> <span class="k">do</span>
    <span class="n">namespace</span> <span class="ss">:v1</span><span class="p">,</span> <span class="ss">defaults: </span><span class="p">{</span><span class="ss">format: :json</span><span class="p">}</span> <span class="k">do</span>
      <span class="n">resources</span> <span class="ss">:my_blogs</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>L√∫c n√†y ch·∫°y rails routes ƒë·ªÉ xem end point nh∆∞ th·∫ø n√†o nh√©. ƒê√¢y l√† c√°c API c·ªßa m√¨nh.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">GET</span>    <span class="sr">/api/</span><span class="n">v1</span><span class="o">/</span><span class="n">my_blogs</span>
<span class="no">POST</span>   <span class="sr">/api/</span><span class="n">v1</span><span class="o">/</span><span class="n">my_blogs</span>
<span class="no">GET</span>    <span class="sr">/api/</span><span class="n">v1</span><span class="o">/</span><span class="n">my_blogs</span><span class="o">/</span><span class="ss">:id</span>
<span class="no">PATCH</span>  <span class="sr">/api/</span><span class="n">v1</span><span class="o">/</span><span class="n">my_blogs</span><span class="o">/</span><span class="ss">:id</span>
<span class="no">PUT</span>    <span class="sr">/api/</span><span class="n">v1</span><span class="o">/</span><span class="n">my_blogs</span><span class="o">/</span><span class="ss">:id</span>
<span class="no">DELETE</span> <span class="sr">/api/</span><span class="n">v1</span><span class="o">/</span><span class="n">my_blogs</span><span class="o">/</span><span class="ss">:id</span>
</code></pre></div></div>

<h2 id="cu·ªëi-c√πng">Cu·ªëi c√πng</h2>

<p>V√¨ b√†i vi·∫øt h∆°i d√†i, n√™n m√¨nh xin ph√©p s·∫Ω ƒë·ªÉ d√†nh Authentication API v√† Vi·∫øt document cho API s·ª≠ d·ª•ng Swagger UI v√†o b√†i vi·∫øt ti·∫øp theo. ^^</p>

<p>C·∫£m ∆°n v√¨ c√°c b·∫°n ƒë√£ ƒë·ªçc ƒë·∫øn ƒë√¢y, hi v·ªçng s·∫Ω gi√∫p √≠t cho c√°c b·∫°n m·ªõi t√¨m hi·ªÉu v·ªÅ RESTful API. ‚ù§Ô∏è üôá</p>

<p>source: Viblo, Google, Tech Blog</p>
:ET